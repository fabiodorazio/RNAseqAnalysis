## simple function to run DESeq2 given a countdata and input for coldata objects

run.deseq.genes <- function(countdata = countdata, stage, type){
  coldata <- data.frame(stage = stage, condition = type)
  row.names(coldata) <- colnames(totalReadsCount)
  head(coldata)
  
  dds <- DESeqDataSetFromMatrix(countData = countdata, colData = coldata, design = ~ stage + condition)
  head(dds)
  dds <- DESeq(dds)
  head(dds)
  normalizedData <- counts(dds, normalized = TRUE) # divides the dds by the size factor. holds the counts in a matrix. Normalized = T devides by the norm factor
  head(normalizedData)
  dds$condition <- factor(dds$condition, levels = c("s128","s1k")) # tells deseq what is the control. Most of times not necessery
  
  res <- results(dds) 
  ## for testing logFC above or belove a threshold:
  res <- results(dds, lfcThreshold = .5, altHypothesis = 'greaterAbs')
  
  #plotMA(res)
  #drawLines <- function() abline(h=c(-.5,.5),col="dodgerblue",lwd=2)
  plotMA(res, ylim = c(-10,10)); drawLines()
  
  return(res)
}
